<div class="d-flex">
  <button class="btn" (click)="getPrevMonth()">
    <svg class="bi text-success " width="32" height="32" fill="currentColor">
      <use xlink:href="assets/bootstrap-icons.svg#chevron-double-left" />
    </svg>
  </button>
  <h1 class="display-5 align-self-end">{{currDate | date:'MMMM'}}'s Budget</h1>
  <button class="btn" (click)="getFutureMonth()">
    <svg class="bi text-success " width="32" height="32" fill="currentColor">
      <use xlink:href="assets/bootstrap-icons.svg#chevron-double-right" />
    </svg>
  </button>
</div>
<div *ngIf="budgetShown; else noBudget">
  <p class="fs-3 text-muted">Estimated income: {{budgetShown.income | currency}}</p>
  <p class="fs-5 text-muted">Actual income so far: {{totalActualIncome | currency}}</p>
  <hr>
  <div style="display: block;">
    <canvas baseChart 
      [datasets]="barChartData"
      [labels]="barChartLabels"
      [options]="barChartOptions"
      [plugins]="barChartPlugins"
      [legend]="barChartLegend"
      [chartType]="barChartType">
    </canvas>
  </div>
  <div class="card card-body shadow">
    <div *ngFor="let parent of budgetShownParents">
      <h2 class="h5 pastel p-3 text-center">{{parent}}</h2>
      <div *ngFor="let total of totals">
        <p *ngIf="total.parent == parent">
          {{total.name}}: {{total.percentage}}% used (
            <span *ngIf="total.remaining >= 0; else over" class="text-success">{{total.remaining | currency}} remaining</span>
            <ng-template #over><span class="text-danger">{{Math.abs(total.remaining) | currency}} over</span></ng-template>
            )
          <ngb-progressbar type="danger" [value]="total.percentage" *ngIf="total.percentage > 100" style="height: 20px;">
            {{total.amount | currency}}</ngb-progressbar>
          <ngb-progressbar type="success" [value]="total.percentage" *ngIf="total.percentage <= 100" style="height: 20px;">
            {{total.amount | currency}}</ngb-progressbar>
        </p>
      </div>
    </div>
    <h2 class="h5 pastel p-3 text-center">Totals</h2>
    <div class="text-center">
      <p>Total saved so far: {{getTotalSaved() | currency}}</p>
      <p>Total spent so far: {{getTotalSpent() - getTotalSaved() | currency}}</p>
      <p>Total amount used: {{getTotalSpent() | currency}} 
        <span *ngIf="getTotalSpent() > getTotalBudgeted(); else under" class="text-danger">over spent by {{this.getTotalSpent() - this.getTotalSaved() - this.getTotalSpendingBudgeted()| currency}}</span>
        <ng-template #under><span class="text-success">under spent by {{getTotalBudgeted() - getTotalSpent() | currency}}</span></ng-template>
      </p>
    </div>
  </div>
</div>
<ng-template #noBudget>
  <div class="alert alert-warning">
    <p>You don't have a budget setup for this month. Make one <a routerLink="/budget-creation">here</a>.</p>
  </div>
</ng-template>
