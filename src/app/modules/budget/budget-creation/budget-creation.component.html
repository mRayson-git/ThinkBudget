<div *ngIf="bs.currBudget; else noBudget">
  <div class="row">
    <div class="col-sm-12 col-md-6">
      <div class="card pastel shadow">
        <div class="card-body">
          <h1>Editing Menu</h1>
          <form [formGroup]="incomeForm" class="mb-3" (ngSubmit)="editIncome()">
            <label for="income">Estimated Monthly Income</label>
            <input type="number" name="income" id="income" formControlName="income" class="form-control">
            <div class="d-grid mt-3">
              <button type="submit" class="btn btn-success">Update income</button>
            </div>
          </form>
          <form [formGroup]="categoryForm" (ngSubmit)="addCategory()">
            <label for="name">Category Name</label>
            <select name="name" id="name" class="form-select" formControlName="name">
              <option value="">Select a category</option>
              <optgroup *ngFor="let parent of bs.parentCategories" label={{parent}}>
                <option *ngFor="let name of bs.getCategoryNames(parent)" value="{{parent}}: {{name}}">{{name}}</option>
              </optgroup>
            </select>
            <label for="amount">Budgeted Amount</label>
            <input type="number" name="amount" id="amount" formControlName="amount" class="form-control">
            <label for="colour">Category Color</label>
            <input type="color" name="colour" id="colour" formControlName="colour" class="form-control form-control-lg"
              value="#42f5b6">
            <div class="d-grid mt-3">
              <button type="submit" class="btn btn-success" [disabled]="categoryForm.invalid">
                <svg class="bi" width="32" height="32" fill="currentColor">
                  <use xlink:href="assets/bootstrap-icons.svg#plus-circle" />
                </svg>
              </button>
            </div>
            <div class="d-grid mt-3">
              <button type="button" class="btn btn-success" (click)="commitChanges()">
                <svg class="bi" width="32" height="32" fill="currentColor">
                  <use xlink:href="assets/bootstrap-icons.svg#arrow-clockwise" />
                </svg>
                Commit Budget Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-6">
        <div class="card card-body pastel shadow">
            <h1>Budget for {{currDate | date:'MMMM'}}</h1>
            <p class="mb-0">Estimated total income: {{bs.currBudget!.income | currency}}</p>
            <p class="my-0">Total Budgeted: {{ getTotalBudgeted() | currency }}</p>
            <p class="mt-0">Remaining to Budget: {{ getRemainingToBudget() | currency }}</p>
            <table class="table table-hover">
              <tbody *ngFor="let parent of currParentCategories" class="mb-0">
                <tr>
                  <td colspan="3" class="table-success">{{parent}}</td>
                </tr>
                <tr *ngFor="let category of bs.currBudget!.categories" (click)="editCategory(category)">
                  <td *ngIf="category.parent == parent">{{category.name}}</td>
                  <td *ngIf="category.parent == parent">{{category.amount | currency}}</td>
                  <td [style.background]="category.colour" *ngIf="category.parent == parent"></td>
                </tr>
              </tbody>
            </table>
        </div>
    </div>
  </div>
</div>
<ng-template #noBudget>
  <h1>Budget Creation for {{currDate | date:'MMMM'}}</h1>
  <div class="card my-3">
    <div class="card-body">
      <div class="row">
        <div class="col-sm-12 col-md-6">
          <form [formGroup]="incomeForm">
            <label for="income">Estimated Monthly Income</label>
            <input type="number" name="income" id="income" formControlName="income" class="form-control">
          </form>
          <p class="mt-3">You can import a default budget and customize, or build one from scratch!</p>
          <div class="d-grid mt-3">
            <button type="button" class="btn btn-success" [disabled]="incomeForm.invalid || bs.currBudget"
              (click)="importDefault()">Import Default Budget</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
